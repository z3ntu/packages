# Maintainer: Michael Walker <mike@barrucadu.co.uk>

pkgname=iso9660fs-static
pkgver=20100321
pkgrel=1
pkgdesc="The GNU Hurd"
arch=(i686)
url="http://www.gnu.org/software/hurd/hurd.html"
license=('GPL')
groups=('base')
depends=('gnumach' 'glibc' 'initscripts')
makedepends=('git' 'glibc')
options=('!makeflags')
backup=()
source=(tls_support.hurd.patch extern_inline_fix.patch)
md5sums=('af87e4b04d89392a2b6e7751361f2460' 'e0910b3df6fc3a18ec44de4299dcf0d0')

_hurdgitroot="git://git.sv.gnu.org/hurd/hurd.git"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d hurd ] ; then
    cd hurd && git pull origin && cd ..
    msg "The local files are updated."
  else
    git clone $_hurdgitroot hurd
  fi
  msg "GIT checkout done or server timeout"
  
  rm -rf "$srcdir/build"
  cp -r "$srcdir/hurd" "$srcdir/build"
  cd "$srcdir/build"
  patch -Np1 < $srcdir/tls_support.hurd.patch
  patch -Np1 < $srcdir/extern_inline_fix.patch

  #
  # BUILD HERE
  #
  export LDFLAGS=`echo $LDFLAGS | sed 's/-Wl,--as-needed//'`
  autoreconf -vif ../hurd
  ./configure --host=i686-pc-gnu --prefix= --disable-profile
  make iso9660fs.static || return 1
}

package() {
  cd "$srcdir/build"
  make prefix="$pkgdir/" install || return 1
} 

