# Maintainer: Stephen Gilles <stephendgilles@gmail.com>
# Contributor: Alexander Preisinger <alexander.preisinger@gmail.com>
# Contributor: Allan McRae <allan@archlinux.org>
# Contributor: Andreas Radke <andyrtr@archlinux.org>

pkgname=file
pkgver=5.06
pkgrel=1
pkgdesc="File type identification utility"
arch=('i686')
license=('custom')
groups=('base')
url="http://www.darwinsys.com/file/"
depends=('glibc' 'zlib')
options=('!libtool')
source=(ftp://ftp.astron.com/pub/$pkgname/$pkgname-$pkgver.tar.gz
        file-5.05-MAXPATHLEN.patch
	file-5.05-python-3.2.patch)

build() {
  cd ${srcdir}/$pkgname-$pkgver

  if [ -e ${srcdir}/.patched ]
  then
    msg "Already patched"
  else
    msg "Patching"
    patch -p0  < ${srcdir}/file-5.05-python-3.2.patch
    patch src/magic.c < ${srcdir}/file-5.05-MAXPATHLEN.patch
    touch ${srcdir}/.patched
  fi

  ./configure --prefix= --datadir=/share/file
  make
}

package(){
  cd ${srcdir}/$pkgname-$pkgver
  
  make DESTDIR=${pkgdir} install
  install -dm755 ${pkgdir}/share/misc
  ln -s ../file/magic.mgc ${pkgdir}/share/misc
  
  install -D -m644 COPYING ${pkgdir}/share/licenses/${pkgname}/COPYING
}
md5sums=('deb12b0fb9d09e7681be72bad6eba4e0'
         'd2d5ec39b67020188e894dc8201146a2'
         '3f5e147be5b9c36c74323a1317328538')
