# Maintainer Matthias Lanzinger <mlaenz@gmail.com>

pkgname=coreutils
pkgver=8.5
pkgrel=2
pkgdesc="The basic file, shell and text manipulation utilities of the GNU operating system"
arch=(i686)
url="http://www.gnu.org/software/coreutils"
license=('GPL3')
groups=('base')
depends=('glibc' 'shadow' 'pam' 'acl' 'gmp' 'sh')
options=('!emptydirs')
backup=('etc/pam.d/su')
install=coreutils.install
source=(ftp://ftp.gnu.org/pub/gnu/$pkgname/$pkgname-$pkgver.tar.xz
        su.pam)
options=('!emptydirs')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  # apply pam patch from archlinux
  # patch -Np1 -i ${srcdir}/coreutils-pam.patch
 
  # autoreconf -v
  sed -i 's@acl_get_file=cross-compiling@acl_get_file=yes@' configure

  ./configure --build=i686-pc-gnu --prefix= \
              --enable-install-program=su \
              --enable-no-install-program=uptime,hostname \
              --enable-pam 
  make 
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  make DESTDIR="$pkgdir/" install
  
  cd "$pkgdir/bin"
  mkdir ../sbin
  mv chroot ../sbin
  chmod u+s su

  install -Dm644 "$srcdir/su.pam" "$pkgdir/etc/pam.d/su"
  
}

md5sums=('55170ed640e300f5b81640c6f4641513'
         'aad79a2aa6d566c375d7bdd1b0767278'
         'fa85e5cce5d723275b14365ba71a8aad')
