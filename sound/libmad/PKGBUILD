# Maintainer: Michael Walker <mike@barrucadu.co.uk>

pkgname=libmad
pkgver=0.15.1b
pkgrel=1
pkgdesc="A high-quality MPEG audio decoder"
arch=(i686)
license=('GPL')
depends=('glibc')
makedepends=('autoconf')
replaces=('mad')
conflicts=('mad')
options=('!libtool')
source=(http://downloads.sourceforge.net/sourceforge/mad/$pkgname-$pkgver.tar.gz
        libmad.patch frame_length.diff optimize.diff)
url="http://www.underbit.com/products/mad/"

md5sums=('1be543bc30c56fb6bea1d7bf6a64e66c'
         'fbcca0267a423bae45389666f4cb04d5'
         '3329b032118a68e18908197e65b3198d'
         '3e52afe2103f367810a18bef9e82eb9f')

build() {
  cd $srcdir/$pkgname-$pkgver

  patch -Np1 -i $srcdir/libmad.patch || return 1
  patch -Np1 -i $srcdir/frame_length.diff || return 1
  patch -Np1 -i $srcdir/optimize.diff || return 1

  CFLAGS="$CFLAGS -ftree-vectorize -ftree-vectorizer-verbose=1"
  autoconf

  ./configure --prefix=
  make || return 1
}

package() {
  cd $srcdir/$pkgname-$pkgver

  make DESTDIR=$pkgdir install
}
